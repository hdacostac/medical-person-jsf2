<ui:composition xmlns="http://www.w3.org/1999/xhtml" template="#{deviceResourceHandler.resolveTemplate()}"
	xmlns:ui="http://java.sun.com/jsf/facelets" 
	xmlns:h="http://java.sun.com/jsf/html" 
	xmlns:f="http://java.sun.com/jsf/core" 
	xmlns:t="http://myfaces.apache.org/tomahawk" 
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:o="http://omnifaces.org/ui"
	xmlns:cegedim="http://java.sun.com/jsf/composite/components">
	<ui:define name="content">
		<style>
			.patientAddress-component-panel {
				height: 145px;
			}
			
			.avatar-size {
				max-width: 188px;
				max-height: 223px;
			}
			
			.ui-fileupload-filename {
				display: inline-block;
				width: 180px;
				white-space: nowrap;
				overflow: hidden !important;
				text-overflow: ellipsis;
			}
		</style>
		
		<div class="card card-w-title" style="max-width: 1000px;margin: 0 auto;">
			<h1>#{bundle['patient.card']}</h1>
			<h:form id="patientForm">
				<p:tabView id="idTabView">
					<p:tab title="#{bundle['patient.info']}">
						<div class="ui-g ui-fluid">
							<div class="ui-g-12">
								<h1>#{bundle['patient.personal.information']}</h1>
							</div>
							<div class="ui-g-3">
								<p:fragment>
									<p:panel id="patientImage" header="#{bundle['patient.form.panel.photo']}" styleClass="ui-shadow-content">
										<p:graphicImage value="#{imagesResourceHandler.image}" rendered="#{not empty entity.url1}" 
											styleClass="avatar-size" alt="avatar_photo">
											<f:param name="filename" value="#{entity.url1}" />
										</p:graphicImage>
										<h:graphicImage library="custom" name="#{avatarType}" rendered="#{empty entity.url1}" 
											styleClass="avatar-size" alt="avatar_photo">
										</h:graphicImage>
										<p:fileUpload id="avatarFileUpload" listener="#{uploadResourcesHandler.handleFileUpload}" 
											sizeLimit="#{appProps['app.avatar-file-size-limit']}"
                                  			allowTypes="/(\.|\/)(jpe?g|png)$/" mode="advanced" process="@this"
                                  			onstart="PF('blockUIWidget').show();" oncomplete="PF('blockUIWidget').hide();"
                                  			auto="true" update="@parent" messageTemplate=" "
                                  			invalidFileMessage="#{commonBundle['avatar.file.type.invalid']}" dragDropSupport="true"
                                  			invalidSizeMessage="#{commonBundle['avatar.file.size.invalid']}" />
                                  		<div>#{commonBundle['avatar.file.size.limit']}<h:outputText value="#{appProps['app.avatar-file-size-limit'] / 1000000}"><f:convertNumber type="number" integerOnly="true" pattern="0MB" /></h:outputText></div>
									</p:panel>
								</p:fragment>
							</div>
							<div class="ui-g-9">
								<div class="ui-g">
									<div class="ui-g-6">
										<cegedim:inputText id="patientName" bundleLabel="#{bundle['patient.form.name']}"
											inputValue="#{entity.name}">
										</cegedim:inputText>
									</div>
									<div class="ui-g-6">
										<cegedim:inputText id="patientLastName" bundleLabel="#{bundle['patient.form.last.name']}"
											inputValue="#{entity.lastName}">
										</cegedim:inputText>
									</div>
									<div class="ui-g-6">
										<cegedim:inputText id="patientIdentityDocument" bundleLabel="#{bundle['patient.form.identity.document']}"
											inputValue="#{entity.identityDocument}">
										</cegedim:inputText>
									</div>
									<div class="ui-g-6">
										<cegedim:inputText id="patientSanitaryDocument" bundleLabel="#{bundle['patient.form.sanitary.document']}"
											inputValue="#{entity.sanitaryDocument}">
										</cegedim:inputText>
									</div>
									<div class="ui-g-6">
										<cegedim:selectOneRadio id="patientSex" bundleLabel="#{bundle['patient.form.sex']}" showLabel="true"
											inputValue="#{entity.sexId}">
											<p:ajax event="change" update="patientForm-idTabView-patientImage" process="@this" />
											<f:selectItems value="#{sexItems}" var="sexItem" itemValue="#{sexItem.id}" itemLabel="#{sexItem.description}" />
										</cegedim:selectOneRadio>
									</div>
									<div class="ui-g-6">
										<cegedim:selectOneMenu id="patientBloodGroup" bundleLabel="#{bundle['patient.form.blood.groups']}" showLabel="true"
											inputValue="#{entity.bloodGroupId}">
											<f:selectItem noSelectionOption="true" itemLabel="#{commonBundle['select.item.none']}" />
											<f:selectItems value="#{bloodGroupsItems}" var="bloodGroupsItem" itemValue="#{bloodGroupsItem.id}" itemLabel="#{bloodGroupsItem.description}" />
										</cegedim:selectOneMenu>
									</div>
									<div class="ui-g-6">
										<cegedim:calendar id="patientBirthDate" bundleLabel="#{bundle['patient.form.birthdate']}" widgetVar="patientBirthDate"
											inputValue="#{entity.birthDate}" maskForControl="patientForm-idTabView-patientBirthDate-patientBirthDateControl_input">
											<p:ajax event="dateSelect" update="patientForm-idTabView-patientAgeCalculationPanel" process="@this" />
											<p:ajax event="blur" update="patientForm-idTabView-patientAgeCalculationPanel" process="@this" onstart="return validateDate('patientBirthDate')" />
										</cegedim:calendar>
									</div>
									<div class="ui-g-6">
										<p:outputPanel id="patientAgeCalculationPanel">
											<p:outputPanel rendered="#{entity.age != null}" style="text-align: center">
												<p:outputPanel styleClass="component-label">
													<h:outputLabel value="#{bundle['patient.label.age.calculated']}" />
												</p:outputPanel>
												<h:outputText id="patientAgeCalculated" value="#{entity.age}" converter="javax.faces.Integer" />
												<h:outputLabel for="patientAgeCalculated" value="#{bundle['patient.label.age.singular']}" rendered="#{entity.age == 1}" style="padding-left:3px" />
												<h:outputLabel for="patientAgeCalculated" value="#{bundle['patient.label.age.plural']}" rendered="#{entity.age > 1}" style="padding-left:3px" />
											</p:outputPanel>
											<p:outputPanel rendered="#{entity.age == null}" style="text-align: center">
												<span>#{bundle['patient.label.age.not.calculated']}</span>
											</p:outputPanel>
										</p:outputPanel>
									</div>
								</div>
							</div>
						</div>
						<div class="ui-g ui-fluid" style="padding-top: 10px">
							<div class="ui-g-12">
								<h1>#{bundle['patient.contact.information']}</h1>
							</div>
							<div class="ui-g-6">
								<cegedim:inputText id="patientMobile" bundleLabel="#{bundle['patient.form.mobile']}"
									inputValue="#{entity.mobilePhone}">
									<f:converter converterId="phoneConverter" for="component" />
								</cegedim:inputText>
							</div>
							<div class="ui-g-6">
								<cegedim:inputText id="patientHomePhone" bundleLabel="#{bundle['patient.form.home.phone']}"
									inputValue="#{entity.homePhone}">
									<f:converter converterId="phoneConverter" for="component" />
								</cegedim:inputText>
							</div>
							<div class="ui-g-12">
								<cegedim:inputText id="patientEmail" bundleLabel="#{bundle['patient.form.email']}"
									inputValue="#{entity.email}" type="email">
								</cegedim:inputText>
							</div>
							<div class="ui-g-12">
								<cegedim:inputText id="patientAddressLine1" bundleLabel="#{bundle['patient.form.address']}"
									inputValue="#{entity.addressLine1}">
								</cegedim:inputText>
							</div>
							<div class="ui-g-12">
								<cegedim:inputText id="patientAddressLine2" bundleLabel="#{bundle['patient.form.address']}"
									inputValue="#{entity.addressLine2}">
								</cegedim:inputText>
							</div>
							<div class="ui-g-4">
								<cegedim:selectOneMenu id="patientProvince" bundleLabel="#{bundle['patient.form.province']}" showLabel="true"
									inputValue="#{entity.provinceId}" filter="true" filterMatchMode="contains">
									<f:selectItem noSelectionOption="true" itemLabel="#{commonBundle['select.item.none']}" />
									<f:selectItems value="#{provinceItems}" var="provinceItem" itemValue="#{provinceItem.id}" itemLabel="#{provinceItem.description}" />
									<f:param name="municipalityItemsToChange" value="municipalityItems" />
									<f:param name="postalCodeItemsToChange" value="postalCodeItems" />
									<p:ajax event="change" listener="#{postalCodeController.onProvinceChange}" update="patientForm-idTabView-patientMunicipality-patientMunicipalityComponent patientForm-idTabView-patientPostalCode-patientPostalCodeComponent" process="@this" />
								</cegedim:selectOneMenu>
							</div>
							<div class="ui-g-4">
								<cegedim:selectOneMenu id="patientMunicipality" bundleLabel="#{bundle['patient.form.municipality']}" showLabel="true"
									inputValue="#{entity.municipalityId}" filter="true" filterMatchMode="contains">
									<f:selectItem noSelectionOption="true" itemLabel="#{commonBundle['select.item.none']}" />
									<f:selectItems value="#{municipalityItems}" var="municipalityItem" itemValue="#{municipalityItem.id}" itemLabel="#{municipalityItem.description}" />
									<f:param name="postalCodeItemsToChange" value="postalCodeItems" />
									<f:param name="provinceItemIdSelected" value="#{entity.provinceId}" />
									<p:ajax event="change" listener="#{postalCodeController.onMunicipalityChange}" update="patientForm-idTabView-patientPostalCode-patientPostalCodeComponent" process="@this" />
								</cegedim:selectOneMenu>
							</div>
							<div class="ui-g-4">
								<cegedim:selectOneMenu id="patientPostalCode" bundleLabel="#{bundle['patient.form.postal.code']}" showLabel="true"
									inputValue="#{entity.postalCodeId}">
									<f:selectItem noSelectionOption="true" itemLabel="#{commonBundle['select.item.none']}" />
									<f:selectItems value="#{postalCodeItems}" var="postalCodeItem" itemValue="#{postalCodeItem.id}" itemLabel="#{postalCodeItem.code}" />
								</cegedim:selectOneMenu>
							</div>
						</div>
						<div class="ui-g ui-fluid">
							<div class="ui-g-12">
								<h1>#{bundle['patient.contact.emergency']}</h1>
							</div>
							<ui:repeat value="#{entity.familyRelationships}" var="familyRelationship">
								<div class="ui-g-4">
									<cegedim:inputText id="patientContact1Name" bundleLabel="#{bundle['patient.form.emergency.contact.name']}"
										inputValue="#{familyRelationship.name}">
									</cegedim:inputText>
								</div>
								<div class="ui-g-4">
									<cegedim:inputText id="patientContact1Phone" bundleLabel="#{bundle['patient.form.emergency.contact.phone']}"
										inputValue="#{familyRelationship.phone}">
										<f:converter converterId="phoneConverter" for="component" />
									</cegedim:inputText>
								</div>
								<div class="ui-g-4">
									<cegedim:selectOneMenu id="patientContact1Relationship" bundleLabel="#{bundle['patient.form.emergency.contact.relationship']}" showLabel="true"
										inputValue="#{familyRelationship.relationship}">
										<f:selectItems value="#{familyRelationshipsItems}" var="familyRelationshipItem" itemValue="#{familyRelationshipItem.code}" itemLabel="#{familyRelationshipItem.description}" />
									</cegedim:selectOneMenu>
								</div>
							</ui:repeat>
						</div>
						<div class="ui-g ui-fluid">
							<div class="ui-g-12">
								<h1>Button tests</h1>
							</div>
							<p:commandButton value="Test values" action="showValues" process="@this" />
						</div>
					</p:tab>
					<p:tab title="#{bundle['patient.info.backgound']}">
					</p:tab>
				</p:tabView>
				<div style="height: 20px; margin-top: 20px">
					<p:commandButton action="save" value="#{commonBundle['button.save']}" icon="ui-icon-check" validateClient="true" 
						style="float: right" update="@form"/>
				</div>
			</h:form>
			<p:focus for="patientForm-idTabView-patientName-patientNameControl" />
		</div>
	</ui:define>
</ui:composition>