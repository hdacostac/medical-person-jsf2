<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://www.springframework.org/schema/webflow"
	xsi:schemaLocation="
		http://www.springframework.org/schema/webflow
		http://www.springframework.org/schema/webflow/spring-webflow.xsd"
	parent="parent-flow">
	
	<var name="entity" class="com.gvt.commons.dto.v1.patient.PatientDTO" />
<!-- 	<var name="uploadHandler" class="com.cegedim.web.resources.UploadResourcesHandler"/> -->
	
	<view-state id="personaInput" view="/WEB-INF/jsf/patient.xhtml" parent="#parentFormState" model="entity">
		<on-entry>
			<evaluate expression="patientController.init(entity, flowRequestContext)" />
		
			<set name="viewScope.sexItems" value="personService.getSexItems()" />
<!-- 			<set name="viewScope.bloodGroupsItems" value="personService.getBloodGroupsItems(flowScope)" /> -->
			<set name="viewScope.familyRelationshipsItems" value="simpleDTOsBuilder.getRelationShips()" />
			<set name="viewScope.provinceItems" value="postalCodesService.getProvinceItems()" />
			
			<set name="viewScope.avatarType" value="'/images/unisex_photo_placeholder.jpg'" />
		</on-entry>
		<on-render>
			<evaluate expression="patientController.updatePatientAge(entity)" />
			<evaluate expression="patientController.updateAvatarType(entity,uploadResourcesHandler,imagesResourceHandler)" />
		</on-render>
		<transition on="save">
			<evaluate expression="patientController.save(entity)" />
		</transition>
	</view-state>
	
</flow>